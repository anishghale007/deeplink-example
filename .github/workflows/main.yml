- name: Test old and new hashes
  run: |
    FILE="praxis/math/CURRICULUM-PRAXIS-Core-Math.json"

    # Check if file exists
    if [ ! -f "$FILE" ]; then
      echo "File $FILE does not exist."
      exit 1
    fi

    # Get old version from previous commit (HEAD^)
    OLD_CONTENT=$(git show HEAD^:$FILE 2>/dev/null || echo "{}")

    # Compute SHA256 hash of old and new files
    OLD_HASH=$(echo "$OLD_CONTENT" | jq -c . | sha256sum | awk '{print $1}')
    NEW_HASH=$(jq -c . "$FILE" | sha256sum | awk '{print $1}')

    echo "Old hash: $OLD_HASH"
    echo "New hash: $NEW_HASH"

    if [ "$OLD_HASH" = "$NEW_HASH" ]; then
      echo "No changes detected."
    else
      echo "Changes detected!"
    fi

    # Determine change_type
    if [ "${GITHUB_EVENT_NAME:-push}" = "pull_request" ]; then
      CHANGE_TYPE="merged"
    elif [ "${GITHUB_EVENT_NAME:-push}" = "workflow_dispatch" ]; then
      CHANGE_TYPE="manual"
    else
      CHANGE_TYPE="updated"
    fi

    echo "Change type: $CHANGE_TYPE"
